{"from": "fastapi import Depends, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer\nfrom jose import jwt\nfrom datetime import datetime, timedelta\nfrom pydantic import BaseModel\nfrom database import User, get_db\n\n# OAuth2 scheme\noauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")\n\n# User credentials\nclass UserCredentials(BaseModel):\n    username: str\n    password: str\n\n# Token data\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\n# Token data with user\nclass TokenData(BaseModel):\n    username: str\n\n# Login route\n@app.post("/token")\ndef login_for_access_token(db: Session = Depends(get_db), credentials: UserCredentials = Depends()):\n    # Verify user credentials\n    user = db.query(User).filter(User.username == credentials.username).first()\n    if not user or not user.password == credentials.password:\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail="Incorrect username or password", headers={"WWW-Authenticate": "Bearer"})\n    # Create access token\n    access_token = jwt.encode({"sub": user.username}, "secret_key", algorithm="HS256")\n    return {"access_token": access_token, "token_type": "bearer"}